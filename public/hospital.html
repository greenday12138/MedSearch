<html>

<head>
    <title>医院详情</title>
    <link rel="stylesheet" href="./lib/bootstrap.css">
    <link rel="stylesheet" href="lib/fonts/iconfont.css">
    <link rel="stylesheet" href="./src/style.css">
    <script src="lib/axios.js"></script>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top ">
        <a class="navbar-brand" href="./index.html"> <span class="glyphicon glyphicon-plus"
                aria-hidden="true"></span>医院详情</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">


        </div>
    </nav>

    <div class="col-12" style="height: 3rem;"></div>

    <main class="row" style="width: 80%;margin: auto;">
        <div class="col-12" style="height: 1rem;"></div>
        <div class="card col-12">
            <div class="card-header">
                医院档案
            </div>
            <div id='info' class="card-body" style="display: none;">
                <img style="width: 200px;height: 150px;" src="src/img/hospital.jpg">
                <h5 id="name" class="card-title">永远亭医院</h5>
                <p id="class" class="card-text">等级</p>
                <p id="address" class="card-text">地址</p>
                <p id="intro" class="card-text">介绍</p>
                <p id="city" class="card-text">城市</p>
                <p id="prov" class="card-text">省份</p>

                <hr>
                <p>医资力量</p>
                <ul class="list-group" id="docs">
                    <li for="1" class="list-group-item collapse-open">11111111111111111</li>
                    <div class="collapse" id="1">
                        <div class="card card-body row">
                            <a onclick="askme(this)" class="col-3" dataid="xxx">xxx</a>
                            <a onclick="askme(this)" class="col-3" dataid="xxx">xxx</a>
                            <a onclick="askme(this)" class="col-3" dataid="xxx">xxx</a>
                            <a onclick="askme(this)" class="col-3" dataid="xxx">xxx</a>
                            <a onclick="askme(this)" class="col-3" dataid="xxx">xxx</a>
                            <a onclick="askme(this)" class="col-3" dataid="xxx">xxx</a>
                            <a onclick="askme(this)" class="col-3" dataid="xxx">xxx</a>
                            <a onclick="askme(this)" class="col-3" dataid="xxx">xxx</a>
                        </div>
                    </div>
                    <li for="2" class="list-group-item collapse-open">22222222222222222222</li>
                    <div class="collapse" id="2">
                        <div class="card card-body">
                            Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad
                            squid. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente
                            ea proident.
                        </div>
                    </div>
                    <li for="3" class="list-group-item collapse-open">33333333333333333333333</li>
                    <div class="collapse" id="3">
                        <div class="card card-body">
                            Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad
                            squid. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente
                            ea proident.
                        </div>
                    </div>
                </ul>
            </div>
        </div>

    </main>

    <script src="lib/jquery.js"></script>
    <script src="lib/bootstrap.bundle.js"></script>
    <script>
        $(".collapse-open").click(function () {
            $(".collapse").collapse('hide');
            let id = $(this).attr('for');
            $(".collapse[id=\'" + id + "\']").collapse('show');
        });
    </script>

    <script>

        function askme(el) {
            let name = el.getAttribute("dataid");
            sessionStorage.setItem('docid', name);
            window.location.href = "./doctors.html";
        }

        function setInfo(data) {
            $("#name")[0].innerText = data.hospital_name;
            $("#class")[0].innerText = data.hospital_class;
            $("#address")[0].innerText = data.hospital_address;
            $("#intro")[0].innerText = data.hospital_introduction;
            $("#city")[0].innerText = data.city_name;
            $("#prov")[0].innerText = data.city_province;
            $("#info").show();


        }

        let key = sessionStorage.getItem('hosid');

        axios.post('/gethosinfo', {
            name: key
        })
            .then(res => {
                console.log(res.data);

                if (res.data) {
                    setInfo(res.data);
                } else {
                    alert("不存在这个医院");
                    window.location.href = "index.html";
                }

            })
            .catch(err => {
                alert("不存在这个医院");
                window.location.href = "index.html";
                console.error(err);
            });

        $("#docs")[0].innerHTML = "";
        axios.post('/staffinfo', {
            name: key
        })
            .then(res => {
                console.log(res);
                let array = res.data;
                for (let i = 0; i < array.length; i++) {
                    let docs = array[i].doctor;
                    let fac = array[i].faculty;
                    //<li for="1" class="list-group-item collapse-open">11111111111111111</li>
                    let li = document.createElement('li');
                    li.className = "list-group-item collapse-open";
                    li.innerText = fac;
                    li.setAttribute("for", i);

                    let dlist = document.createElement('div');
                    dlist.className = "collapse";
                    dlist.setAttribute('id', i);
                    let dlistb = document.createElement('div');
                    dlistb.className = "card card-body row";
                    //<a onclick="askme(this)" class="col-3" dataid="xxx">xxx</a>

                    for (let i = docs; i < docs.length; i++) {
                        let l = documen.createElement('li');
                        let n = docs[i];
                        l.className = "col-3";
                        l.innerHTML = '<a onclick="askme(this)" dataid="' + n + '">' + n + '</a>';
                        dlistb.appendChild(l);
                    }
                    dlist.appendChild(dlistb);
                    $("#docs")[0].appendChild(li);
                    $("#docs")[0].appendChild(dlist);
                }
                $(".collapse-open").click(function () {
                    $(".collapse").collapse('hide');
                    let id = $(this).attr('for');
                    $(".collapse[id=\'" + id + "\']").collapse('show');
                });
            })
            .catch(err => {
                alert("获取医生列表失败");
                console.error(err);
            })

    </script>
</body>

</html>